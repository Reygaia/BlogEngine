@page
@model BlogEngineClone.Areas.Blog.Pages.UserProfileModel
@{
    string currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
    string targetfollowID = "053d0db9-1928-4f99-8ec8-ee4f7b3c0abf";
    // string targetfollowID = HttpContext.Request.RouteValues["targetUserID"]?.ToString();
    bool checker = false;
}

<div>
    @*
        if followed show unfollow button 
        cai nay la dung api kiem tra file json de co follow hay khong
        vi database no k co luu duoc dang list
        logic thi kiem user trong database
        neu co thi tra r roi kiem trong file json co hay khong
    *@
    <button id="follow">
    </button>

    @*
        duoi day la them chuc nang load cai bai viet cua blogger da dang roi het roi con muon them gi thi tinh sau
    *@
</div>

<div>
    <button id="loaddata" data-wall-id="f89db200-0129-4503-aa97-78557214cc1f" >
        <span>
            click me to load
        </span>
    </button>
    <p id="userDataContainer">

    </p>
</div>

<div>
    
    @foreach(var item in Model._context.Users.ToList()){
        <div style="margin-top: 20px">
            <p>@item.name</p>
            <p>@item.Email</p>
            <p>@item.Id</p>
            <button class="loaddata" data-wall-id="@item.Id">
                <span>
                    Test
                </span>
                <p class="userDataContainer">

                </p>
            </button>
        </div>
    }
</div>


<script>
    // LoadFollowButton()

    // LoadUser();

    // baseapiurl = "https://localhost:7234"
    // apiendpoint = "/api/User/CheckFollow"

    // LoadPosts()

    //     baseapiurl = "https://localhost:7234"
    //     apiendpoint = "/api/User/LoadUser"

    const buttons = document.getElementsByClassName('loaddata');

    for (const button of buttons) {
        button.addEventListener('click', function () {
            const wallId = this.getAttribute('data-wall-id');
            console.log('Wall ID:', wallId);

            fetch(`https://localhost:7234/api/User/LoadUser/${wallId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(wallId)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Response:', data);

                    // Check if data is defined and contains expected properties
                    if (data && data.hasOwnProperty('userID') && data.hasOwnProperty('userName')) {
                        // Generate HTML string
                        const htmlString = `<p>Call Successful. User name is: ${data.userName}</p>`;

                        // Update the HTML content for the specific userDataContainer associated with the clicked button
                        const userDataContainer = this.querySelector('.userDataContainer');
                        userDataContainer.innerHTML = htmlString;
                    } else {
                        console.error('Invalid response format:', data);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    }


    function toggleFollow() {
        var userId = "user1"; // Replace with the actual user ID
        var targetId = "user2"; // Replace with the actual target user ID

        // Make an AJAX request to the server
        $.ajax({
            type: 'POST',
            url: '/FollowBtn/' + targetId,
            contentType: 'application/json',
            data: JSON.stringify({ UserID: userId, TargetID: targetId }),
            headers: {
                'Authorization': 'Bearer ' + getAccessToken() // Include the JWT token
            },
            success: function (data) {
                alert(data.message); // Show the result in an alert (you can customize this part)
            },
            error: function (error) {
                console.log(error);
            }
        });
    }

    function getAccessToken() {
        // Assume the token is stored in a cookie named 'access_token'
        return getCookie('access_token');
    }

    function getCookie(name) {
        const value = "; " + document.cookie;
        const parts = value.split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
    }
        
    document.getElementById('followButton').addEventListener('click', function () {
        // Get user IDs from data attributes
        const userID = "@currentUserId";
        const targetID = "@targetfollowID";

        console.log(targetID);

        // Create the request object
        const request = {
            UserID: userID,
            TargetID: targetID
        };

        // Send POST request to the API endpoint
        fetch('/api/User/Follow', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(request),
        })
            .then(response => {
                if (response.ok) {
                    console.log('Follow successful!');
                    // You can update the button text or style here if needed
                } else {
                    console.error('Follow failed:', response.statusText);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });

    
</script>

